/* 
  Sketch generated by the Arduino IoT Cloud Thing "Untitled"
  https://create.arduino.cc/cloud/things/fa642e24-17b1-4eb1-b540-df305f571f9e 

  Arduino IoT Cloud Variables description

  The following variables are automatically generated and updated when changes are made to the Thing

  float esikSicaklik;
  float nem;
  float sicaklik;
  bool alarmDurumu;

  Variables which are marked as READ/WRITE in the Cloud Thing will also have functions
  which are called when their values are changed from the Dashboard.
  These functions are generated with the Thing and added at the end of this sketch.
*/

#include "thingProperties.h"
#include <DHT.h>
#include <DHT_U.h>

byte dhtPin=2; //dht bağlı olduğı pin

DHT dhtSensor(dhtPin, DHT11); //dht nesnesi tanımladık

void setup() {
 
  Serial.begin(9600);
  delay(1500); 

  initProperties();
  dhtSensor.begin(); //dht sensoru başlattık.
  

  ArduinoCloud.begin(ArduinoIoTPreferredConnection);
  
  setDebugMessageLevel(2);
  ArduinoCloud.printDebugInfo();
}

void loop() {
  ArduinoCloud.update();
  delay(1500);

  float s=dhtSensor.readTemperature();
  float n=dhtSensor.readHumidity();

  if(!isnan(s)&&!isnan(n)){
    sicaklik=s;
    nem=n;

    Serial.print("Sıcaklık: ");
    Serial.print(s);
    Serial.print(" C  Nem:  ");
    Serial.println(n);

    if(s>=esikSicaklik){
      alarmDurumu=true;
      Serial.println("ALARM: Esik sicakligi asildi.");
    }else{
      alarmdurumu=false;
    }
  }else{
    Serial.println("Sensor okuma hatası");
  }
}



/*
  Since EsikSicaklik is READ_WRITE variable, onEsikSicaklikChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onEsikSicaklikChange()  {
  Serial.print("Esik Sicaklik Degeri: ");
  Serial.println(esikSicaklik);
  
}
