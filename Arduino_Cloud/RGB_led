/* 
  Sketch generated by the Arduino IoT Cloud Thing "Untitled"
  https://create.arduino.cc/cloud/things/4d8e5a93-11b8-4f5a-81df-fbdbcf9771e6 

  Arduino IoT Cloud Variables description

  The following variables are automatically generated and updated when changes are made to the Thing

  CloudColor rgbRenk;
  int calismaModu;
  int nemAyarla;
  int toprakNemi;
  bool sulamaDurumu;

  Variables which are marked as READ/WRITE in the Cloud Thing will also have functions
  which are called when their values are changed from the Dashboard.
  These functions are generated with the Thing and added at the end of this sketch.
*/

#include "thingProperties.h"

byte motorPin=2;
byte nemPin=A0;
byte kirmiziPin=3;
byte yesilPin=4;

void setup() {

  pinMode(motorPin, OUTPUT);
  pinMode(kirmiziPin, OUTPUT);
  pinMode(yesilPin, OUTPUT);

  Serial.begin(9600);
  delay(1500); 


  initProperties();


  ArduinoCloud.begin(ArduinoIoTPreferredConnection);
  
  setDebugMessageLevel(2);
  ArduinoCloud.printDebugInfo();
}

void loop() {
  ArduinoCloud.update();
  // Your code here 

  toprakNemi = analogRead(nemPin);

  if(calismaModu==0){
    digitalWrite(motorPin, sulamaDurumu ? HIGH : LOW);
  }
  else if(calismaModu==1){
    if(toprakNemi<nemAyarla){
      sulamaDurumu=true;
    }else{
      sulamaDurumu=false;
  }
    digitalWrite(motorPin, sulamaDurumu ? HIGH : LOW);
}
  delay(500);
}


void onCalismaModuChange()  {
 
}


void onSulamaDurumuChange()  {
   if (calismaModu == 0) {
    digitalWrite(motorPin, sulamaDurumu ? HIGH : LOW);
  }

}


void onNemAyarlaChange()  {
 
}


void onRgbRenkChange()  {
  int r = rgbRenk.getRed();
  int g = rgbRenk.getGreen();


  analogWrite(kirmiziPin,   map(r, 0, 255, 0, 1023));
  analogWrite(yesilPin, map(g, 0, 255, 0, 1023));
  
}
